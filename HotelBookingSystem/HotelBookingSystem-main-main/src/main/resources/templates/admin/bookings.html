<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Qu·∫£n l√Ω booking ‚Äî Admin</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root{
            --accent-1:#29a14a;
            --muted:#6b7280;
            --card:#fff;
            --bg:#f6f8fb;
            --radius:12px;
            --shadow:0 8px 24px rgba(11,24,40,0.06)
        }
        body{
            font-family:Inter,system-ui;
            margin:0;
            background:var(--bg);
            padding:28px;
            color:#0f172a
        }
        .wrap{max-width:1200px;margin:0 auto}
        .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .card{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
        table{width:100%;border-collapse:collapse;margin-top:12px}
        th,td{padding:12px 10px;text-align:left;border-bottom:1px solid #eef2f6;font-size:14px}
        th{color:var(--muted);font-weight:700;font-size:13px}
        .badge{padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px}
        .status-pending{background:#fff7ed;color:#92400e}
        .status-confirmed{background:#ecfdf5;color:#065f46}
        .status-cancelled{background:#fff1f2;color:#b91c1c}
        .btn{
            background:linear-gradient(90deg,var(--accent-1),#178e3a);
            color:white;
            padding:8px 10px;
            border-radius:8px;
            border:none;
            cursor:pointer;
            font-weight:700
        }
        .btn-danger{background:#ef4444}
        .btn-ghost{
            background:transparent;
            border:1px solid #e6eef3;
            padding:6px 10px;
            border-radius:8px;
            text-decoration:none;
            color:#0f172a;
            font-weight:600
        }
        .actions form{display:inline-block;margin-right:6px}
    </style>
</head>

<body>
<div class="wrap">
    <div class="head">
        <div>
            <h2 style="margin:0">üìã Qu·∫£n l√Ω booking</h2>
            <div style="color:#6b7280">X√°c nh·∫≠n, hu·ª∑ v√† x·ª≠ l√Ω ho√†n ti·ªÅn</div>
        </div>
        <a th:href="@{/admin/dashboard}" class="btn-ghost">‚¨Ö Dashboard</a>
    </div>

    <div class="card">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>User</th>
                <th>Room</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Gi√°</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Refund</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="b : ${bookings}">
                <td th:text="${b.id}">1</td>
                <td th:text="${b.user.email}">user@test.com</td>
                <td th:text="${b.room.roomNumber}">101</td>
                <td th:text="${#temporals.format(b.checkIn,'yyyy-MM-dd')}">2026-01-01</td>
                <td th:text="${#temporals.format(b.checkOut,'yyyy-MM-dd')}">2026-01-05</td>
                <td th:text="${#numbers.formatDecimal(b.totalPrice,0,'COMMA',0,'POINT')} + ' VND'">
                    1,000,000 VND
                </td>

                <!-- BOOKING STATUS -->
                <td>
                    <span th:if="${b.status.name()=='PENDING_CONFIRM'}" class="badge status-pending">‚è≥ Ch·ªù</span>
                    <span th:if="${b.status.name()=='CONFIRMED'}" class="badge status-confirmed">‚úì OK</span>
                    <span th:if="${b.status.name()=='CANCELLED'}" class="badge status-cancelled">‚úó Hu·ª∑</span>
                </td>

                <!-- REFUND STATUS -->
                <td th:text="${b.refundStatus}">NONE</td>

                <!-- ACTIONS -->
                <td class="actions">
                    <!-- ACCEPT -->
                    <form th:if="${b.status.name()=='PENDING_CONFIRM'}"
                          th:action="@{/admin/bookings/{id}/accept(id=${b.id})}"
                          method="post">
                        <button class="btn" type="submit">Accept</button>
                    </form>

                    <!-- DENY -->
                    <form th:if="${b.status.name()=='PENDING_CONFIRM'}"
                          th:action="@{/admin/bookings/{id}/deny(id=${b.id})}"
                          method="post"
                          onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën t·ª´ ch·ªëi booking n√†y?');">
                        <button class="btn btn-danger" type="submit">Deny</button>
                    </form>

                    <!-- REFUND TRANSFERRED -->
                    <form th:if="${b.status.name()=='CANCELLED' and b.refundStatus.name()=='REQUESTED'}"
                          th:action="@{/admin/bookings/{id}/refund-transferred(id=${b.id})}"
                          method="post">
                        <button class="btn" type="submit">üí∏ ƒê√£ chuy·ªÉn ti·ªÅn</button>
                    </form>

                    <span th:if="${b.status.name()!='PENDING_CONFIRM' 
                                  and b.refundStatus.name()!='REQUESTED'}"
                          style="color:#9ca3af;font-weight:600">‚Äî</span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>